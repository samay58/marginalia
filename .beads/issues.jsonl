{"id":"marg-0ca","title":"Blank window when running debug binary directly","description":"**Repro**: Run `./src-tauri/target/debug/marginalia open file.md` without Vite dev server running.\n\n**Expected**: App opens with file content.\n**Actual**: Blank white window.\n\n**Root Cause**: Debug binary hardcoded to `devUrl: http://localhost:1420` in tauri.conf.json. When Vite isn't running, WebView loads nothing.\n\n**Fix Options**:\n1. Build release binary (`pnpm tauri build`) which bundles frontend from `frontendDist: ../build`\n2. Add Vite server check/auto-start to launch script\n3. Create CLI wrapper that ensures Vite is running before launching binary\n\n**Impact**: Agentic workflows break because hooks can't reliably launch the app.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-21T01:11:03.976848-08:00","updated_at":"2026-01-21T01:11:03.976848-08:00"}
{"id":"marg-2um","title":"Polish: insertion highlights missing last character","description":"When adding a word like 'would', the green highlight sometimes misses the last character ('d'). Related to offset-to-position mapping in prosemirror-text.js and milkdown-diff-plugin.js. Current fix uses lastCharPos + 1 but still has edge cases.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-21T13:12:26.734453-08:00","updated_at":"2026-01-21T13:12:26.734453-08:00"}
{"id":"marg-2ut","title":"Polish: general diff decoration smoothness","description":"Overall goal: make diff decorations feel smooth and snappy. Current issues tracked separately, but this is the umbrella for 'it just doesn't feel polished yet' feedback.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-21T13:12:39.111703-08:00","updated_at":"2026-01-21T13:12:39.111703-08:00"}
{"id":"marg-3oo","title":"Phase 5: Output - bundle generation and CLI","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T23:02:26.707885-08:00","updated_at":"2026-01-19T23:43:49.68102-08:00","closed_at":"2026-01-19T23:43:49.68102-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-43w","title":"Phase 4: Comments - annotation system with popovers","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T23:02:21.426332-08:00","updated_at":"2026-01-19T23:43:49.680557-08:00","closed_at":"2026-01-19T23:43:49.680557-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-451","title":"Diff visualization feels buggy - diagnose and fix","description":"**User feedback (2026-01-21)**: 'we really need to clean up how the diff'ing works. It feels super buggy - we need to diagnose why and then work on fixing that experience otherwise this won't achieve the feel we're aiming for'\n\n**Symptoms to investigate**:\n- Diff decorations may appear in wrong positions\n- Visual glitches when editing near diff markers\n- Possible race conditions between edit and diff recalculation\n- Text verification logic may be too aggressive or not aggressive enough\n\n**Current architecture**:\n- diff-match-patch library computes changes\n- milkdown-diff-plugin.js creates ProseMirror decorations\n- Deletions = widget decorations (struck-through spans)\n- Insertions = inline decorations (highlight with .added class)\n- prosemirror-text.js buildTextMap() maps plain text offsets to doc positions\n\n**Previous fix (marg-f1m)**: Added text verification and stable IDs for diff stability. May need further refinement.\n\n**Next steps**:\n1. Reproduce specific buggy scenarios\n2. Add console logging to trace diff computation vs decoration placement\n3. Check if race condition between store update and decoration refresh\n4. Consider debouncing or batching diff updates\n\n**Goal**: Diff visualization should feel rock-solid and predictable, not janky.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-21T01:47:54.204029-08:00","updated_at":"2026-01-21T01:47:54.204029-08:00"}
{"id":"marg-4hg","title":"Agentic sessions cannot monitor app completion","description":"**Problem**: When Claude Code launches Marginalia via hook, there's no way to:\n1. Know when user finishes editing\n2. Wait for bundle creation\n3. Read the bundle output automatically\n\n**Current behavior**: Hook runs Marginalia with `\u0026` (background) and exits immediately. Claude moves on without the user's feedback.\n\n**Root Cause**: No blocking or polling mechanism. The `--out` flag exists but isn't used in the hook, and even then polling isn't implemented.\n\n**Proposed Fix**:\n1. Remove `\u0026` from hook - run synchronously so script blocks until app closes\n2. Use `--out /tmp/marginalia-$$.txt` to capture bundle path\n3. Hook prints bundle path to stdout for Claude to capture\n4. Or: Claude polls `~/phoenix/.marginalia/bundles/` for new entries with timestamp \u003e session start\n\n**Impact**: This is the core agentic loop bug - without it, Marginalia can't be used as an interactive co-authoring tool with Claude.","status":"open","priority":0,"issue_type":"bug","created_at":"2026-01-21T01:11:20.527085-08:00","updated_at":"2026-01-21T01:11:20.527085-08:00"}
{"id":"marg-6h8","title":"Phase 1: Foundation - Tauri scaffold, design tokens, layout","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-19T23:01:57.184669-08:00","updated_at":"2026-01-19T23:43:49.677431-08:00","closed_at":"2026-01-19T23:43:49.677431-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-6oa","title":"Phase 6: Polish - dark mode, animations, error handling","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-19T23:02:32.179056-08:00","updated_at":"2026-01-19T23:43:49.682321-08:00","closed_at":"2026-01-19T23:43:49.682321-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-73q","title":"v0.2: Sync gutter scroll with editor","description":"Gutter scrolls independently from editor. Need to sync scroll positions so line numbers align with content when scrolling.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-19T23:46:52.267567-08:00","updated_at":"2026-01-20T11:17:50.920509-08:00","closed_at":"2026-01-20T11:17:50.920509-08:00","close_reason":"Closed"}
{"id":"marg-7mw","title":"Phase 3: Diff - diff-match-patch with decorations","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T23:02:08.918823-08:00","updated_at":"2026-01-19T23:43:49.680084-08:00","closed_at":"2026-01-19T23:43:49.680084-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-8i1","title":"Phase 2: Editor - CodeMirror integration with custom theme","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T23:02:02.907739-08:00","updated_at":"2026-01-19T23:43:49.679475-08:00","closed_at":"2026-01-19T23:43:49.679475-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-95g","title":"Polish: spacing around deletion widgets","description":"Deletion widgets sometimes create awkward spacing with adjacent text. The space before 'be' after the 'would' deletion looks off. Need to investigate widget positioning and CSS.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-21T13:12:33.646399-08:00","updated_at":"2026-01-21T13:12:33.646399-08:00"}
{"id":"marg-ate","title":"Phase 7: Integration - Claude Code hooks and Phoenix setup","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T23:02:38.03484-08:00","updated_at":"2026-01-19T23:43:49.6829-08:00","closed_at":"2026-01-19T23:43:49.6829-08:00","close_reason":"v0.1 implementation complete"}
{"id":"marg-ccx","title":"v0.2: Implement CLI flags (--bundle-dir, --principles, --out)","description":"Spec mentions CLI flags that aren't implemented: --bundle-dir to specify output location, --principles to point to WRITING.md, --out for scripting.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T23:46:46.745603-08:00","updated_at":"2026-01-20T11:45:52.200223-08:00","closed_at":"2026-01-20T11:45:52.200223-08:00","close_reason":"Closed"}
{"id":"marg-cx4","title":"v1.5: WRITING.md integration - read and match rules","description":"Read ~/phoenix/WRITING.md for existing principles. Auto-match annotations to existing rules. Surface matched rules in summary_for_agent.md.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-19T23:46:29.687032-08:00","updated_at":"2026-01-20T13:37:53.236306-08:00","closed_at":"2026-01-20T13:37:53.236306-08:00","close_reason":"Closed"}
{"id":"marg-dks","title":"v0.2: Apply visual diff decorations in editor","description":"CSS classes exist (.cm-struck, .cm-added) but diff results aren't actively applied as CodeMirror decorations. Need to wire up decorations.js to Editor.svelte.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-19T23:46:35.483281-08:00","updated_at":"2026-01-20T11:17:59.709431-08:00","closed_at":"2026-01-20T11:17:59.709431-08:00","close_reason":"Closed"}
{"id":"marg-f1m","title":"v0.2: Stabilize diff widget placement during edits","description":"Repro: open sample memo, delete 'before' and edit around 'arguably/ly'. Deletion widget appears in wrong position, redline overlaps nearby text, and typing becomes unreliable. In prior runs the window closed before further edits. Goal: stabilize diff widget placement and ensure normal typing after deletions/insertions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-20T14:41:58.392559-08:00","updated_at":"2026-01-20T22:57:43.165541-08:00","closed_at":"2026-01-20T22:57:43.165541-08:00","close_reason":"Fixed in v0.2: text verification for diff stability, file picker dialog"}
{"id":"marg-jac","title":"Implement blocking hook architecture for agentic loop","description":"**Problem**: Claude launches Marginalia and immediately moves on. No way to wait for user completion or read bundle output.\n\n**Proposed Solution (from brainstorm session 2026-01-21)**:\n\n1. Hook runs Marginalia **synchronously** (remove `\u0026` from hook)\n2. Use `--out /tmp/marginalia-$$.txt` to capture bundle path\n3. Hook reads --out file after app closes\n4. Hook prints bundle path to stdout\n5. Claude Code captures that output in tool result\n\n**Alternative approaches considered**:\n- Polling with timeout (blocks Claude, can't respond during wait)\n- fswatch on bundles directory (fragile, needs install)\n- Cooperative handoff (current workaround - user says 'done')\n\n**Key insight**: The `--out` flag already exists. The fix is making the hook blocking so the entire write→review→revise cycle happens in one tool call.\n\n**Acceptance criteria**:\n- Claude writes a draft file\n- Hook fires, Marginalia opens\n- User edits, closes app\n- Claude receives bundle path in tool output\n- Claude reads bundle and can revise","status":"open","priority":0,"issue_type":"feature","created_at":"2026-01-21T01:46:42.550721-08:00","updated_at":"2026-01-21T01:46:42.550721-08:00"}
{"id":"marg-kko","title":"v1.5: Anti-slop detection - highlight WRITING.md violations","description":"Scan original draft for WRITING.md violations before user starts editing. Highlight em-dashes, banned words, hedging phrases with visual flags in gutter.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-19T23:46:24.047491-08:00","updated_at":"2026-01-20T13:57:14.647427-08:00","closed_at":"2026-01-20T13:57:14.647427-08:00","close_reason":"Closed"}
{"id":"marg-rxz","title":"No way to open arbitrary file - launches with cached/default file","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-20T17:10:08.42716-08:00","updated_at":"2026-01-20T22:57:43.167565-08:00","closed_at":"2026-01-20T22:57:43.167565-08:00","close_reason":"Fixed in v0.2: text verification for diff stability, file picker dialog"}
{"id":"marg-se6","title":"No undo/redo - accidental edits cannot be reverted","description":"**Repro**: Delete a paragraph, try Cmd+Z to undo.\n\n**Expected**: Deletion is undone.\n**Actual**: Nothing happens.\n\n**Root Cause**: Milkdown's history plugin (`@milkdown/plugin-history`) is NOT installed. The commonmark preset doesn't include undo/redo.\n\n**Fix**:\n```bash\npnpm add @milkdown/plugin-history\n```\n\nThen in Editor.svelte:\n```javascript\nimport { history } from '@milkdown/plugin-history';\n// ...\n.use(history)\n```\n\n**User Impact**: User accidentally deleted entire paragraph during testing session and couldn't recover it.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-21T01:12:18.223079-08:00","updated_at":"2026-01-21T01:12:18.223079-08:00"}
{"id":"marg-w2i","title":"v0.2: Implement window close after bundle save","description":"Currently handleDone() logs but doesn't close the window. Need Tauri window.close() or process.exit() after successful bundle save.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T23:46:41.140668-08:00","updated_at":"2026-01-20T11:30:44.842348-08:00","closed_at":"2026-01-20T11:30:44.842348-08:00","close_reason":"Closed"}
